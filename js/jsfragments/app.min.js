(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=Object.prototype.hasOwnProperty,t=function(a,b){function d(){this.constructor=a}for(var c in b)s.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},u=function(a,b){return function(){return a.apply(b,arguments)}};q=$.TmplDeck("templates.html"),$.fn.linkBlankify=function(){return this.each(function(){return $(this).find("a").each(function(){return $(this).attr("target","_blank")})})},$.fn.shake=function(){return this.each(function(){var a;return a=30,$(this).stop().animate({left:"-6px"},a).animate({left:"6px"},a).animate({left:"-6px"},a).animate({left:"6px"},a).animate({left:"0px"},a)})},r=function(a){return $.Deferred(function(b){return setTimeout(function(){return b.resolve()},a||0)}).promise()},twttr.formatDate=function(a){var b,c,d,e,f,g,h;return b=new Date(a),h=b.getFullYear(),h!==h&&(b=new Date(a.replace(/^([^ ]+) ([^ ]+) ([^ ]+) ([^ ]+) ([^ ]+) ([^ ]+)$/,"$1, $3 $2 $6 $4 $5")),h=b.getFullYear()),f=b.getMonth()+1,c=b.getDate(),d=b.getHours(),e=b.getMinutes(),g=""+h+"/"+f+"/"+c+" "+d+":"+e},p={},p.searchTweets=function(a){var b,c;return b=null,c=$.Deferred(function(c){return b=$.ajax({url:"http://search.twitter.com/search.json",dataType:"jsonp",data:{result_type:"recent",rpp:100,page:1,q:a}}).pipe(function(a){return c.resolve(a,function(){return c.reject().always(function(){return b=null})})})}).promise(),c.abort=function(){return b!=null&&b.abort(),c},c},d=function(){function a(){}return _.extend(a.prototype,Backbone.Events),a.prototype.add=function(a){return this.items==null&&(this.items=[]),this.items.push(a),this.trigger("sizechange",this.size())},a.prototype.reset=function(){return this.items=[],this},a.prototype.size=function(){return this.items?this.items.length:0},a.prototype.remove=function(a){return this.items=_.without(this.items,a),this.trigger("sizechange",this.size()),this},a}(),h=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return t(b,a),b}(Backbone.Model),i=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.model=h,b}(Backbone.Collection),l=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.update=function(){var a=this;return this.trigger("searchstart"),this.updateDefer=p.searchTweets(this.get("query")),this.updateDefer.pipe(function(b){return a.tweets=new i(b.results),a.trigger("success")},function(){return a.trigger("error")}).always(function(){return a.updateDefer=null}),this.updateDefer},b.prototype.destroy=function(){var a;return(a=this.updateDefer)!=null&&a.abort(),b.__super__.destroy.apply(this,arguments),this},b}(Backbone.Model),m=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.model=l,b.prototype.localStorage=new Store("twittersearch"),b.prototype.loadCached=function(){var a=this;return _.each(this.localStorage.findAll(),function(b){return a.add(b)})},b.prototype.updateCache=function(a){return this.localStorage.find(a)?this.localStorage.update(a):this.localStorage.create(a),this.localStorage.save(),this},b.prototype.add=function(a){var c;return c=new this.model(a),b.__super__.add.call(this,c),this.updateCache(c),this},b.prototype.updateAllSearches=function(){return this.each(function(a){return a.update()}),this},b}(Backbone.Collection),n=new m,c=function(){function a(a){var b,c;b={color:"#fff",length:20,radius:30},c=(new Spinner(b)).spin(a[0]),this.el=c.el,this.$el=$(c.el)}return a}(),o=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.options={widthPerItem:300},b.prototype.initialize=function(){return this.update(1)},b.prototype.update=function(a){return this.$el.width(this.options.widthPerItem*(a+1))},b}(Backbone.View),e=function(a){function b(){this.toggle=u(this.toggle,this),b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.events={"click .mod-newlist-btn":"toggle"},b.prototype.initialize=function(){return this.els={content_closed:this.$(".mod-newlist-content-closed"),content_opened:this.$(".mod-newlist-content-opened")}},b.prototype.toggle=function(){return this.$el.toggleClass("state-close state-open")},b}(Backbone.View),g=function(a){function b(){this._submitHandler=u(this._submitHandler,this),b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.events={submit:"_submitHandler"},b.prototype.initialize=function(){return this.els={input:this.$("input[type=search]")}},b.prototype._submitHandler=function(a){var b;a.preventDefault(),b=this.els.input.val();if(!b)return;return this.trigger("submit",b)},b}(Backbone.View),k=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.className="mod-tweetitem",b.prototype.render=function(){return this.$el.html(q.tmpl("TweetView",this.model.toJSON())),this},b}(Backbone.View),j=function(a){function b(){this.remove=u(this.remove,this),this.reload=u(this.reload,this),b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.className="mod-tweetlist",b.prototype.events={"click .mod-tweetlist-util-reload":"reload","click .mod-tweetlist-remove":"remove"},b.prototype.initialize=function(){var a=this;return this.els={},this.manager=new d,this.model.bind("searchstart",function(){return a.renderLoading()}),this.model.bind("success",function(){return a.renderContent()}),this.model.bind("error",function(){return a.renderError()}),this.model.update()},b.prototype.refreshItems=function(){var a=this;return this.model.tweets.length?this.model.tweets.each(function(b){var c;return c=new k({model:b}),a.manager.add(c),a.els.bd.append(c.render().el)}):this.els.bd.append(q.draw("TweetView-noresult")),this},b.prototype.renderLoading=function(){var a=this;return this.$el.html(q.tmpl("TweetListView-frame",this.model.toJSON())),this.els.bd=this.$(".mod-tweetlist-bd"),r(0).done(function(){var b;return b=new c(a.els.bd),a.els.spinner=b.$el}),this},b.prototype.renderContent=function(){var a=this;return this.els.spinner.fadeOut(function(){return a.els.spinner.remove(),a.refreshItems(),a.els.bd.hide().fadeIn().linkBlankify()}),this},b.prototype.renderError=function(){return this.$el.html(q.tmpl("TweetListView-error")),this},b.prototype.reload=function(){return this.model.update()},b.prototype.remove=function(){var a=this;return this.$el.fadeOut(400,"easeOutExpo",function(){return a.model.destroy(),a.manager.reset(),a.$el.remove(),a.trigger("remove",a)}),this},b}(Backbone.View),b=function(a){function b(){this.addOne=u(this.addOne,this),b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.initialize=function(){var a=this;return this.manager=new d,this.els={inner:this.$(".mod-listcontainer-inner"),items:this.$(".mod-listcontainer-items")},this.widthChanger=new o({el:this.els.inner}),this.manager.bind("sizechange",function(b){return a.widthChanger.update(b)}),n.bind("add",this.addOne)},b.prototype.addOne=function(a){var b,c,d=this;return b=a,c=new j({model:b}),c.bind("remove",function(){return d.manager.remove(c)}),this.els.items.append(c.el),this.manager.add(c),this},b}(Backbone.View),f=function(){function a(a){this.interval=this.counter=a}return _.extend(a.prototype,Backbone.Events),a.prototype._tickDefer=null,a.prototype.tick=function(){var a,b=this;return a={paused:!1,tick:function(){return r(1e3).done(function(){if(a.paused)return;return b.counter--,b.trigger("tick",b.counter),b.counter===0&&(b.counter=b.interval+1,b.trigger("hitzero")),b.tick()})},destroy:function(){return a.paused=!0}},a.tick(),this._currentTick=a,this},a.prototype.resume=function(){var a;return(a=this._currentTick)!=null&&a.destroy(),this.tick(),this},a.prototype.pause=function(){var a;return(a=this._currentTick)!=null&&a.destroy(),this},a.prototype.reset=function(a){return a&&(this.interval=a),this.counter=this.interval+1,this},a}(),a=function(a){function b(){this._keydownHandler=u(this._keydownHandler,this),this.escInput=u(this.escInput,this),this.toInput=u(this.toInput,this),b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.events={focus:"toInput",blur:"escInput",keydown:"_keydownHandler"},b.prototype.initialize=function(){var a,b=this;return a=360,this.timer=new f(a),this.$el.val(a),this.timer.bind("tick",function(a){return b.$el.val(a)}),this.timer.bind("hitzero",function(){return b.trigger("hitzero")}),this.timer.resume()},b.prototype.toInput=function(){return this._lastVal=this.$el.val(),this.$el.addClass("state-input"),this.timer.pause(),this},b.prototype.escInput=function(){var a,b;return this.$el.removeClass("state-input"),b=this.$el.val(),b!==this._lastVal&&(/^\d+$/.test(b)?(a=parseInt(b,10),this.timer.reset(a)):(this.$el.shake(),this.$el.val(this.timer.counter))),this.timer.resume(),this},b.prototype.reset=function(){return this.timer.reset()},b.prototype._keydownHandler=function(a){return a.keyCode===13&&this.$el.trigger("blur"),this},b}(Backbone.View),q.load().done(function(){return $(function(){var c,d,f,h;return f=new e({el:$("#newlist")}),d=new b({el:$("#listcontainer")}),h=new g({el:$("#searchform")}),c=new a({el:$("#autoreloader")}),h.bind("submit",function(a){return n.add({query:a})}),c.bind("hitzero",function(){return n.updateAllSearches()}),$("#reloadall").click(function(){return c.reset(),n.updateAllSearches()}),n.loadCached()})})}).call(this)